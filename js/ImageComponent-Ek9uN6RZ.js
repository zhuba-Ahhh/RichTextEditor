import{u as e,l as t,o as a,n as s,p as n,f as r,m as i,t as o,b as l,a as c,c as d,S as u,C as m,N as g,O as h,r as f,e as x,j as p,g as j,q as R,s as C,_ as b,i as E,v,k as w,w as N}from"./.pnpm-B3_Y5Cmd.js";import{f as S,b as y,g as k,N as T,h as W,E as I,i as D,d as L,L as _,P as z,T as K,I as A}from"./index-DmT7TJFY.js";const B=new Set,F=N();function H({altText:e,className:t,imageRef:a,src:s,width:n,height:r,maxWidth:i}){return function(e){if(!B.has(e))throw new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{B.add(e),t(null)}}))}(s),p.jsx("img",{className:t||void 0,src:s,alt:e,ref:a,style:{height:r,maxWidth:i,width:n},draggable:"false"})}function P({src:N,altText:B,nodeKey:P,width:q,height:G,maxWidth:M,resizable:U,showCaption:V,caption:J,captionsEnabled:O}){const Q=React.useRef(null),X=React.useRef(null),[Y,Z,$]=e(P),[ee,te]=React.useState(!1),{isCollabActive:ae}=t(),[se]=a(),[ne,re]=React.useState(null),ie=React.useRef(null),oe=React.useCallback((e=>{if(Y&&s(n())){e.preventDefault();const t=r(P);if(S(t))return t.remove(),!0}return!1}),[Y,P]),le=React.useCallback((e=>{const t=n(),a=X.current;if(Y&&s(t)&&1===t.getNodes().length){if(V)return i(null),e.preventDefault(),J.focus(),!0;if(null!==a&&a!==document.activeElement)return e.preventDefault(),a.focus(),!0}return!1}),[J,Y,V]),ce=React.useCallback((e=>(ie.current===J||X.current===e.target)&&(i(null),se.update((()=>{Z(!0);const e=se.getRootElement();null!==e&&e.focus()})),!0)),[J,se,Z]),de=React.useCallback((e=>{const t=e;return!!ee||t.target===Q.current&&(t.shiftKey?Z(!Y):($(),Z(!0)),!0)}),[ee,Y,Z,$]),ue=React.useCallback((e=>{se.getEditorState().read((()=>{const t=n();"IMG"===e.target.tagName&&o(t)&&1===t.getNodes().length&&se.dispatchCommand(F,e)}))}),[se]);React.useEffect((()=>{let e=!0;const t=se.getRootElement(),a=l(se.registerUpdateListener((({editorState:t})=>{e&&re(t.read((()=>n())))})),se.registerCommand(x,((e,t)=>(ie.current=t,!1)),d),se.registerCommand(f,de,d),se.registerCommand(F,de,d),se.registerCommand(h,(e=>e.target===Q.current&&(e.preventDefault(),!0)),d),se.registerCommand(g,oe,d),se.registerCommand(m,oe,d),se.registerCommand(u,le,d),se.registerCommand(c,ce,d));return null==t||t.addEventListener("contextmenu",ue),()=>{e=!1,a(),null==t||t.removeEventListener("contextmenu",ue)}}),[$,se,ee,Y,P,oe,le,ce,de,ue,Z]);const{historyState:me}=y(),{settings:{showNestedEditorTreeView:ge}}=k(),he=Y&&s(ne)&&!ee,fe=Y||ee;return p.jsx(React.Suspense,{fallback:null,children:p.jsxs(p.Fragment,{children:[p.jsx("div",{draggable:he,children:p.jsx(H,{className:fe?"focused "+(s(ne)?"draggable":""):null,src:N,altText:B,imageRef:Q,width:q,height:G,maxWidth:M})}),V&&p.jsx("div",{className:"image-caption-container",children:p.jsxs(j,{initialEditor:J,children:[p.jsx(R,{}),p.jsx(T,{}),p.jsx(W,{}),p.jsx(I,{}),p.jsx(C,{}),p.jsx(D,{}),ae?p.jsx(b,{id:J.getKey(),providerFactory:L,shouldBootstrap:!0}):p.jsx(E,{externalHistoryState:me}),p.jsx(v,{contentEditable:p.jsx(_,{className:"ImageNode__contentEditable"}),placeholder:p.jsx(z,{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:w}),!0===ge?p.jsx(K,{}):null]})}),U&&s(ne)&&fe&&p.jsx(A,{showCaption:V,setShowCaption:()=>{se.update((()=>{const e=r(P);S(e)&&e.setShowCaption(!0)}))},editor:se,buttonRef:X,imageRef:Q,maxWidth:M,onResizeStart:()=>{te(!0)},onResizeEnd:(e,t)=>{setTimeout((()=>{te(!1)}),200),se.update((()=>{const a=r(P);S(a)&&a.setWidthAndHeight(e,t)}))},captionsEnabled:O})]})})}export{F as RIGHT_CLICK_IMAGE_COMMAND,P as default};
