import{o as e,u as o,n as t,p as n,f as s,b as l,C as a,c as i,N as d,r as c,j as r,l as p}from"./.pnpm-HDZr3mw8.js";import{a as u,B as h,j as m,c as N}from"./index-B6LWV7O6.js";function _({option:e,index:o,options:t,totalVotes:n,withPollNode:s}){const{clientID:l}=p(),a=React.useRef(null),i=e.votes,d=-1!==i.indexOf(l),c=i.length,u=e.text;return r.jsxs("div",{className:"PollNode__optionContainer",children:[r.jsx("div",{className:m("PollNode__optionCheckboxWrapper",d&&"PollNode__optionCheckboxChecked"),children:r.jsx("input",{ref:a,className:"PollNode__optionCheckbox",type:"checkbox",onChange:o=>{s((o=>{o.toggleVote(e,l)}))},checked:d})}),r.jsxs("div",{className:"PollNode__optionInputWrapper",children:[r.jsx("div",{className:"PollNode__optionInputVotes",style:{width:(0===c?0:c/n*100)+"%"}}),r.jsx("span",{className:"PollNode__optionInputVotesCount",children:c>0&&(1===c?"1 vote":`${c} votes`)}),r.jsx("input",{className:"PollNode__optionInput",type:"text",value:u,onChange:o=>{const t=o.target,n=t.value,l=t.selectionStart,a=t.selectionEnd;s((o=>{o.setOptionText(e,n)}),(()=>{t.selectionStart=l,t.selectionEnd=a}))},placeholder:`Option ${o+1}`})]}),r.jsx("button",{disabled:t.length<3,className:m("PollNode__optionDelete",t.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remove",onClick:()=>{s((o=>{o.deleteOption(e)}))}})]})}function x({question:p,options:m,nodeKey:x}){const[f]=e(),j=React.useMemo((()=>function(e){return e.reduce(((e,o)=>e+o.votes.length),0)}(m)),[m]),[v,P,g]=o(x),[C,b]=React.useState(null),k=React.useRef(null),R=React.useCallback((e=>{if(v&&t(n())){e.preventDefault();const o=s(x);if(u(o))return o.remove(),!0}return!1}),[v,x]);React.useEffect((()=>l(f.registerUpdateListener((({editorState:e})=>{b(e.read((()=>n())))})),f.registerCommand(c,(e=>{const o=e;return o.target===k.current&&(o.shiftKey||g(),P(!v),!0)}),i),f.registerCommand(d,R,i),f.registerCommand(a,R,i))),[g,f,v,x,R,P]);const O=(e,o)=>{f.update((()=>{const o=s(x);u(o)&&e(o)}),{onUpdate:o})},y=t(C)&&v;return r.jsx("div",{className:"PollNode__container "+(y?"focused":""),ref:k,children:r.jsxs("div",{className:"PollNode__inner",children:[r.jsx("h2",{className:"PollNode__heading",children:p}),m.map(((e,o)=>{const t=e.uid;return r.jsx(_,{withPollNode:O,option:e,index:o,options:m,totalVotes:j},t)})),r.jsx("div",{className:"PollNode__footer",children:r.jsx(h,{onClick:()=>{O((e=>{e.addOption(N())}))},small:!0,children:"Add Option"})})]})})}export{x as default};
