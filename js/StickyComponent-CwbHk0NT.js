import{o as e,l as t,j as n,d as o,g as s,_ as r,i as l,x as i,k as c,f as a}from"./.pnpm-YQU93M_N.js";import{t as u,u as d,b as g,d as f,L as p,P as m,e as x}from"./index-DOxFOQ8P.js";const y={...u,paragraph:"StickyEditorTheme__paragraph"};function v(e,t){const n=e.style,o=t.rootElementRect,s=null!==o?o.left:0,r=null!==o?o.top:0;n.top=r+t.y+"px",n.left=s+t.x+"px"}function E({x:u,y:E,nodeKey:h,color:R,caption:j}){const[b]=e(),k=React.useRef(null),C=React.useRef({isDragging:!1,offsetX:0,offsetY:0,rootElementRect:null,x:0,y:0}),{isCollabActive:L}=t();React.useEffect((()=>{const e=C.current;e.x=u,e.y=E;const t=k.current;null!==t&&v(t,e)}),[u,E]),d((()=>{const e=C.current,t=new ResizeObserver((t=>{for(let n=0;n<t.length;n++){const o=t[n],{target:s}=o;e.rootElementRect=s.getBoundingClientRect();const r=k.current;null!==r&&v(r,e)}})),n=b.registerRootListener(((e,n)=>{null!==n&&t.unobserve(n),null!==e&&t.observe(e)})),o=()=>{const t=b.getRootElement(),n=k.current;null!==t&&null!==n&&(e.rootElementRect=t.getBoundingClientRect(),v(n,e))};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o),n()}}),[b]),React.useEffect((()=>{const e=k.current;null!==e&&setTimeout((()=>{e.style.setProperty("transition","top 0.3s ease 0s, left 0.3s ease 0s")}),500)}),[]);const N=e=>{const t=k.current,n=C.current,s=n.rootElementRect,r=o(t);null!==t&&n.isDragging&&null!==s&&(n.x=e.pageX/r-n.offsetX-s.left,n.y=e.pageY/r-n.offsetY-s.top,v(t,n))},D=e=>{const t=k.current,n=C.current;null!==t&&(n.isDragging=!1,t.classList.remove("dragging"),b.update((()=>{const e=a(h);x(e)&&e.setPosition(n.x,n.y)}))),document.removeEventListener("pointermove",N),document.removeEventListener("pointerup",D)},{historyState:w}=g();return n.jsx("div",{ref:k,className:"sticky-note-container",children:n.jsxs("div",{className:`sticky-note ${R}`,onPointerDown:e=>{const t=k.current;if(null===t||2===e.button||e.target!==t.firstChild)return;const n=t,s=C.current;if(null!==n){const{top:t,left:r}=n.getBoundingClientRect(),l=o(n);s.offsetX=e.clientX/l-r,s.offsetY=e.clientY/l-t,s.isDragging=!0,n.classList.add("dragging"),document.addEventListener("pointermove",N),document.addEventListener("pointerup",D),e.preventDefault()}},children:[n.jsx("button",{onClick:()=>{b.update((()=>{const e=a(h);x(e)&&e.remove()}))},className:"delete","aria-label":"Delete sticky note",title:"Delete",children:"X"}),n.jsx("button",{onClick:()=>{b.update((()=>{const e=a(h);x(e)&&e.toggleColor()}))},className:"color","aria-label":"Change sticky note color",title:"Color",children:n.jsx("i",{className:"bucket"})}),n.jsxs(s,{initialEditor:j,initialTheme:y,children:[L?n.jsx(r,{id:j.getKey(),providerFactory:f,shouldBootstrap:!0}):n.jsx(l,{externalHistoryState:w}),n.jsx(i,{contentEditable:n.jsx(p,{className:"StickyNode__contentEditable"}),placeholder:n.jsx(m,{className:"StickyNode__placeholder",children:"What`'`s up?"}),ErrorBoundary:c})]})]})})}export{E as default};
