import{j as e,o as n,f as t,b as a,a as s,h as r,e as i,p as o,n as c,E as l}from"./.pnpm-YQU93M_N.js";import{$ as u,K as d}from"./index-DOxFOQ8P.js";const E=React.forwardRef((function({equation:n,setEquation:t,inline:a},s){const r=e=>{t(e.target.value)};return a&&s instanceof HTMLInputElement?e.jsxs("span",{className:"EquationEditor_inputBackground",children:[e.jsx("span",{className:"EquationEditor_dollarSign",children:"$"}),e.jsx("input",{className:"EquationEditor_inlineEditor",value:n,onChange:r,autoFocus:!0,ref:s}),e.jsx("span",{className:"EquationEditor_dollarSign",children:"$"})]}):e.jsxs("div",{className:"EquationEditor_inputBackground",children:[e.jsx("span",{className:"EquationEditor_dollarSign",children:"$$\n"}),e.jsx("textarea",{className:"EquationEditor_blockEditor",value:n,onChange:r,ref:s}),e.jsx("span",{className:"EquationEditor_dollarSign",children:"\n$$"})]})}));function m({equation:m,inline:f,nodeKey:p}){const[x]=n(),[g,j]=React.useState(m),[q,h]=React.useState(!1),N=React.useRef(null),R=React.useCallback((e=>{h(!1),x.update((()=>{const n=t(p);u(n)&&(n.setEquation(g),e&&n.selectNext(0,0))}))}),[x,g,p]);return React.useEffect((()=>{q||g===m||j(m)}),[q,m,g]),React.useEffect((()=>q?a(x.registerCommand(i,(e=>{const n=document.activeElement;return N.current!==n&&R(),!1}),r),x.registerCommand(s,(e=>{const n=document.activeElement;return N.current===n&&(R(!0),!0)}),r)):x.registerUpdateListener((({editorState:e})=>{e.read((()=>{const e=o();return c(e)&&e.has(p)&&1===e.getNodes().length}))&&h(!0)}))),[x,p,R,q]),e.jsx(e.Fragment,{children:q?e.jsx(E,{equation:g,setEquation:j,inline:f,ref:N}):e.jsx(l,{onError:e=>x._onError(e),fallback:null,children:e.jsx(d,{equation:g,inline:f,onDoubleClick:()=>h(!0)})})})}export{m as default};
